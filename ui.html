<link
  rel="stylesheet"
  href="https://static.figma.com/api/figma-extension-api-0.0.1.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/thomas-lowry/figma-plugin-ds/dist/figma-plugin-ds.css"
/>

<div id="panel">
  <h2 calss="type--xlarge">Count Text Nodes</h2>
  <div class="inputs-container">
    <div>
      <label class="type--small" for="find-input">Find</label>
      <input
        class="input__field"
        type="input"
        id="find-input"
        placeholder="Find"
        value=""
      />
      <div id="set-regex" class="icon-button icon-button--selected">
        <div class="icon">Regex</div>
      </div>
    </div>
    <div>
      <label class="type--small" for="replace-input">Replace</label>
      <input
        class="input__field"
        type="input"
        id="replace-input"
        placeholder="Replace"
      />
    </div>
  </div>
  <button id="find-button">Find</button>
  <div>
    <p>Found nodes:</p>
    <p style="font-size: 20px" id="count">0</p>
  </div>
</div>

<script>
  let keyupTimeout;
  let regex = true;
  document.getElementById("panel").addEventListener("keyup", (e) => {
    if (e.target.tagName === "INPUT" && e.target.value.length) {
      clearTimeout(keyupTimeout);
      keyupTimeout = setTimeout(function () {
        parent.postMessage(
          {
            pluginMessage: {
              type: e.target.id,
              value: e.target.value,
              regex: regex,
            },
          },
          "*"
        );
      }, 700);
    }
  });
  document.getElementById("set-regex").onclick = (e) => {
    e.preventDefault();
    if (e.currentTarget.className.includes("icon-button--selected")) {
      e.currentTarget.classList.remove("icon-button--selected");
      regex = false;
    } else {
      e.currentTarget.classList.add("icon-button--selected");
      regex = true;
    }
  };
  document.getElementById("find-button").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "find-button" } }, "*");
  };
  onmessage = (event) => {
    document.getElementById("count").textContent = event.data.pluginMessage;
  };
</script>
