<link
  rel="stylesheet"
  href="https://static.figma.com/api/figma-extension-api-0.0.1.css"
/>

<div id="panel">
  <h2>Count Text Nodes</h2>
  <div>
    <label for="find-input">Find</label>
    <input type="input" id="find-input" placeholder="Find" value="" />
  </div>
  <div>
    <label for="replace-input">Replace</label>
    <input type="input" id="replace-input" placeholder="Replace" />
  </div>
  <button id="find-button">Find</button>
  <div>
    <p>Found nodes:</p>
    <p style="font-size: 20px" id="count">0</p>
  </div>
</div>

<script>
  let keyupTimeout;
  document.getElementById("panel").addEventListener("keyup", (e) => {
    if (e.target.tagName === "INPUT" && e.target.value.length) {
      clearTimeout(keyupTimeout);
      keyupTimeout = setTimeout(function () {
        parent.postMessage(
          {
            pluginMessage: {
              type: e.target.id,
              value: e.target.value,
            },
          },
          "*"
        );
      }, 700);
    }
  });
  document.getElementById("find-button").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "find-button" } }, "*");
  };
  onmessage = (event) => {
    document.getElementById("count").textContent = event.data.pluginMessage;
  };
</script>
